(this["webpackJsonpvk-your-diary"]=this["webpackJsonpvk-your-diary"]||[]).push([[1],{117:function(e,n,t){e.exports=t(147)},123:function(e,n,t){var a={"./ion-action-sheet.entry.js":[150,5],"./ion-alert.entry.js":[151,6],"./ion-app_8.entry.js":[152,7],"./ion-avatar_3.entry.js":[153,18],"./ion-back-button.entry.js":[154,19],"./ion-backdrop.entry.js":[155,43],"./ion-button_2.entry.js":[156,20],"./ion-card_5.entry.js":[157,21],"./ion-checkbox.entry.js":[158,22],"./ion-chip.entry.js":[159,23],"./ion-col_3.entry.js":[160,44],"./ion-datetime_3.entry.js":[161,10],"./ion-fab_3.entry.js":[162,24],"./ion-img.entry.js":[163,45],"./ion-infinite-scroll_2.entry.js":[164,46],"./ion-input.entry.js":[165,25],"./ion-item-option_3.entry.js":[166,26],"./ion-item_8.entry.js":[167,27],"./ion-loading.entry.js":[168,28],"./ion-menu_3.entry.js":[169,29],"./ion-modal.entry.js":[170,8],"./ion-nav_2.entry.js":[171,15],"./ion-popover.entry.js":[172,9],"./ion-progress-bar.entry.js":[173,30],"./ion-radio_2.entry.js":[174,31],"./ion-range.entry.js":[175,32],"./ion-refresher_2.entry.js":[176,11],"./ion-reorder_2.entry.js":[177,17],"./ion-ripple-effect.entry.js":[178,47],"./ion-route_4.entry.js":[179,33],"./ion-searchbar.entry.js":[180,34],"./ion-segment_2.entry.js":[181,35],"./ion-select_3.entry.js":[182,36],"./ion-slide_2.entry.js":[183,48],"./ion-spinner.entry.js":[184,13],"./ion-split-pane.entry.js":[185,49],"./ion-tab-bar_2.entry.js":[186,37],"./ion-tab_2.entry.js":[187,16],"./ion-text.entry.js":[188,38],"./ion-textarea.entry.js":[189,39],"./ion-toast.entry.js":[190,40],"./ion-toggle.entry.js":[191,12],"./ion-virtual-scroll.entry.js":[192,50]};function r(e){if(!t.o(a,e))return Promise.resolve().then((function(){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}));var n=a[e],r=n[0];return t.e(n[1]).then((function(){return t(r)}))}r.keys=function(){return Object.keys(a)},r.id=123,e.exports=r},125:function(e,n,t){var a={"./ion-icon.entry.js":[196,57]};function r(e){if(!t.o(a,e))return Promise.resolve().then((function(){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}));var n=a[e],r=n[0];return t.e(n[1]).then((function(){return t(r)}))}r.keys=function(){return Object.keys(a)},r.id=125,e.exports=r},145:function(e,n,t){},146:function(e,n,t){},147:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),l=t(58),o=t.n(l),c=t(46),i=t(3),u=t(115),s=t(83),m=t(33),p=t(22),d=t(105),b=t(108),f={query:{add:{GetJoinedGroups:"\u0441\u043f\u0438\u0441\u043e\u043a \u0433\u0440\u0443\u043f\u043f"},full:{}},mutate:{add:{CreateGroup:"\u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u0433\u0440\u0443\u043f\u043f\u0443",joinGroup:"\u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u0441\u044f \u043a \u0433\u0440\u0443\u043f\u043f\u0435"},full:{}}},E=r.a.createContext(void 0),h=E.Provider,j=function(){return Object(a.useContext)(E)},v=function(e){var n=e.children,t=Object(a.useState)(null),l=Object(m.a)(t,2),o=l[0],c=l[1],u=Object(a.useState)(null),E=Object(m.a)(u,2),j=E[0],v=E[1],y=Object(a.useMemo)((function(){var e=new p.HttpLink({uri:"https://vk-your-diary.herokuapp.com/graphql"}),n=Object(b.a)((function(e){var n,t,a=e.operation,r=e.networkError,l=a.query.definitions[0].operation;v({type:"message",title:"query"===l||"mutate"===l?(n=l,t=a.operationName,f[n].full[t]||"".concat("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c").concat("query"===n?" \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c":""," ").concat(f[n].add[t]||"".concat("mutate"===n?"\u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c ":"","\u0434\u0430\u043d\u043d\u044b\u0435"))):"GraphQL Error",message:r?r.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u043e \u0447\u0442\u043e-\u0442\u043e \u0441\u0442\u0440\u0430\u0448\u043d\u043e\u0435..."})})),t=new p.ApolloLink((function(e,n){var t=e.getContext(),a=n(e);return c(t.loaderText||""),a.subscribe({complete:function(){return c(null)},error:function(){return c(null)}}),a})),a=Object(d.a)((function(e,n){var t=n.headers;return{headers:Object(s.a)(Object(s.a)({},t),{},{authorization:window.location.search.slice(1)})}}));return new p.ApolloClient({link:a.concat(t).concat(n).concat(e),cache:new p.InMemoryCache})}),[]);return r.a.createElement(r.a.Fragment,null,o&&r.a.createElement(i.s,{isOpen:!0,translucent:!0,message:o}),j&&("message"===j.type?r.a.createElement(i.b,{isOpen:!0,translucent:!0,backdropDismiss:!1,header:j.title||"\u0422\u0432\u043e\u0439 \u0414\u043d\u0435\u0432\u043d\u0438\u043a",message:j.message,onDidDismiss:function(){j.handler&&j.handler(),v(null)},buttons:["OK"]}):"destruction"===j.type?r.a.createElement(i.b,{isOpen:!0,translucent:!0,backdropDismiss:!1,header:j.title,message:j.message,onDidDismiss:function(){return v(null)},buttons:[{text:j.confirmText,role:"destructive",handler:j.confirmHandler},{text:"\u041e\u0442\u043c\u0435\u043d\u0430",role:"cancel"}]}):null),r.a.createElement(p.ApolloProvider,{client:y},r.a.createElement(h,{value:{dialog:j,setDialog:v}},n)))},y=t(18),g=function(){return r.a.createElement(i.u,null,r.a.createElement(i.i,null,r.a.createElement(i.H,null,r.a.createElement(i.F,null,"\u0414\u043d\u0435\u0432\u043d\u0438\u043a"))),r.a.createElement(i.h,{fullscreen:!0},"\u0414\u043d\u0435\u0432\u043d\u0438\u043a"))},k=function(){return r.a.createElement(i.u,null,r.a.createElement(i.i,null,r.a.createElement(i.H,null,r.a.createElement(i.F,null,"Tab 1"))),r.a.createElement(i.h,{fullscreen:!0},r.a.createElement(i.i,{collapse:"condense"},r.a.createElement(i.H,null,r.a.createElement(i.F,{size:"large"},"test")))))},O=function(){return r.a.createElement(i.D,null,r.a.createElement(i.A,null,r.a.createElement(c.b,{path:"/group/diary",component:g}),r.a.createElement(c.b,{path:"/group/info",component:k})),r.a.createElement(i.B,{slot:"bottom"},r.a.createElement(i.C,{tab:"diary",href:"/group/diary"},r.a.createElement(i.j,{icon:y.s}),r.a.createElement(i.p,null,"\u0414\u043d\u0435\u0432\u043d\u0438\u043a")),r.a.createElement(i.C,{tab:"group",href:"/group/info"},r.a.createElement(i.j,{icon:y.j}),r.a.createElement(i.p,null,"\u0413\u0440\u0443\u043f\u043f\u0430"))))},w=t(39),x=t.n(w),C=function(e){var n=e.darkSchemeBodyClass;Object(a.useEffect)((function(){var e=function(e){switch(e.detail.type){case"VKWebAppUpdateConfig":!function(e){if(n){var t="client_dark"===e||"space_gray"===e,a=document.body;t?a.classList.add(n):a.classList.remove(n)}}(e.detail.data.scheme)}};return x.a.send("VKWebAppInit"),x.a.subscribe(e),function(){x.a.unsubscribe(e)}}),[])},_=t(13),I=t.n(_),T=t(24),L=t(49),G=t(76);function S(){var e=Object(L.a)(["\n    mutation CreateGroup($isModerated: Boolean!, $groupName: String!, $description: String!, $enableInviteLink: Boolean!) {\n        createGroup(isModerated: $isModerated, groupName: $groupName, description: $description, enableInviteLink: $enableInviteLink)\n    }\n"]);return S=function(){return e},e}var q=Object(p.gql)(S()),D=function(){var e=Object(i.R)(),n=Object(p.useMutation)(q,{update:function(e,n){return Object(T.a)(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.data){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.reset();case 5:case"end":return t.stop()}}),t)})))()},onCompleted:function(){e.back()},context:{loaderText:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b..."}}),t=Object(m.a)(n,1)[0],a=Object(G.a)({initialValues:{groupName:"",description:"",isModerated:!1,enableInviteLink:!0},onSubmit:function(){var e=Object(T.a)(I.a.mark((function e(n){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(n),t({variables:n});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}),l=a.handleSubmit,o=a.handleChange,c=a.values,u=a.setFieldValue,s=a.errors;return r.a.createElement(i.u,null,r.a.createElement(i.i,null,r.a.createElement(i.H,null,r.a.createElement(i.g,{slot:"start"},r.a.createElement(i.e,null)),r.a.createElement(i.F,null,"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"))),r.a.createElement(i.h,{fullscreen:!0},r.a.createElement(i.i,{collapse:"condense",translucent:!0},r.a.createElement(i.H,null,r.a.createElement(i.F,{size:"large"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"))),r.a.createElement("form",{onSubmit:l},r.a.createElement(i.q,{lines:"full"},r.a.createElement(i.l,null,r.a.createElement(i.p,{position:"stacked"},"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b"),r.a.createElement(i.k,{maxlength:50,clearInput:!0,onIonChange:o,required:!0,name:"groupName"})),r.a.createElement(i.w,{name:"isModerated",value:c.isModerated,onIonChange:o},r.a.createElement(i.r,null,r.a.createElement(i.p,null,"\u0422\u0438\u043f \u0433\u0440\u0443\u043f\u043f\u044b")),r.a.createElement(i.l,null,r.a.createElement(i.p,null,"\u0421\u0432\u043e\u0431\u043e\u0434\u043d\u0430\u044f"),r.a.createElement(i.v,{slot:"start",value:!1})),r.a.createElement(i.l,null,r.a.createElement(i.p,null,"\u041c\u043e\u0434\u0435\u0440\u0438\u0440\u0443\u0435\u043c\u0430\u044f"),r.a.createElement(i.v,{slot:"start",value:!0}))),r.a.createElement(i.l,null,r.a.createElement(i.p,null,"\u041f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0441\u0441\u044b\u043b\u043a\u0430"),r.a.createElement(i.G,{name:"enableInviteLink",checked:c.enableInviteLink,onIonChange:function(e){return u("enableInviteLink",e.detail.checked)}}))),r.a.createElement(i.l,null,r.a.createElement(i.E,{name:"description",placeholder:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 (\u043d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e)",value:c.description,onIonChange:o,maxlength:400})),r.a.createElement(i.f,{expand:"block",disabled:0!==Object.keys(s).length,type:"submit"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"))))},F=t(111);function M(){var e=Object(L.a)(["\n    mutation JoinGroup($inviteToken: String!) {\n        joinGroup(inviteToken: $inviteToken)\n    }\n"]);return M=function(){return e},e}var $=Object(p.gql)(M()),A=function(e){var n=/\w{8}-\w{4}-11eb-\w{4}-\w{12}/;if(n.test(e))return e;try{var t=new URL(e);if("vk.com"!==t.hostname)throw new TypeError("Its not even a VK link");if(!t.pathname.startsWith("/app".concat(Object(F.a)("app_id"))))throw new TypeError("This link doesn't belong to this vk app");if(!t.hash.startsWith("#invite"))throw new TypeError("This link doesn't contain invite token");var a=t.hash.slice("#invite".length);if(n.lastIndex=0,!n.test(a))throw new TypeError("Invalid invite token");return a}catch(r){return null}},H=function(){var e=j().setDialog,n=Object(p.useMutation)($,{context:{loaderText:"\u041f\u043e\u0438\u0441\u043a \u0433\u0440\u0443\u043f\u043f\u044b..."}}),t=Object(m.a)(n,1)[0],l=Object(G.a)({initialValues:{inviteLinkOrToken:""},onSubmit:function(n){var a=n.inviteLinkOrToken,r=A(a);r?t({variables:{inviteToken:r}}):e({type:"message",title:"\u041e\u0448\u0438\u0431\u043a\u0430",message:"\u041f\u043e\u043b\u0435 \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0438 \u0438\u043b\u0438 \u0442\u043e\u043a\u0435\u043d\u0430"})}}),o=l.handleSubmit,c=l.values,u=l.handleChange,s=Object(a.useCallback)(Object(T.a)(I.a.mark((function n(){var a,r;return I.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,a=x.a.send("VKWebAppOpenQR"),r=A(a.qr_data||a.code_data)){n.next=5;break}return n.abrupt("return");case 5:t({variables:{inviteToken:r}}),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),e({type:"message",message:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c QR"});case 11:case"end":return n.stop()}}),n,null,[[0,8]])}))),[t,e]);return r.a.createElement(i.u,null,r.a.createElement(i.i,null,r.a.createElement(i.g,{slot:"start"},r.a.createElement(i.e,null)),r.a.createElement(i.H,null,r.a.createElement(i.F,null,"\u041f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u043a \u0433\u0440\u0443\u043f\u043f\u0435"))),r.a.createElement(i.h,{fullscreen:!0},r.a.createElement(i.i,{collapse:"condense",translucent:!0},r.a.createElement(i.H,null,r.a.createElement(i.F,{size:"large"},"\u041f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u043a \u0433\u0440\u0443\u043f\u043f\u0435"))),r.a.createElement(i.f,{expand:"block",fill:"outline",disabled:!x.a.supports("VKWebAppOpenQR"),onClick:s},"\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c QR"),r.a.createElement("form",{onSubmit:o},r.a.createElement(i.q,null,r.a.createElement(i.l,null,r.a.createElement(i.p,{position:"stacked"},"\u0421\u0441\u044b\u043b\u043a\u0430 \u0438\u043b\u0438 \u043a\u043b\u044e\u0447 \u043f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u044f \u0433\u0440\u0443\u043f\u043f\u044b"),r.a.createElement(i.k,{clearInput:!0,onIonChange:u,required:!0,value:c.inviteLinkOrToken,name:"inviteLinkOrToken",autoCapitalize:"off",enterkeyhint:"enter"}))),r.a.createElement(i.f,{expand:"block",type:"submit"},"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0433\u0440\u0443\u043f\u043f\u0443"))))},N=function(){x.a.send("VKWebAppTapticSelectionChanged")},R="/joined-groups/",V="/create-group/",W="/join-group/";function B(){var e=Object(L.a)(["\n    mutation LeaveGroup($groupId: Int!) {\n        leaveGroup(groupId: $groupId) \n    }\n"]);return B=function(){return e},e}function K(){var e=Object(L.a)(["\n    query GetJoinedGroups {\n        joinedGroups {\n            id\n            name\n            membersCount\n            ownerId\n            ownerSmallAvatar\n        }\n}\n"]);return K=function(){return e},e}var Q=Object(p.gql)(K()),z=Object(p.gql)(B()),U=function(){var e=Object(i.R)(),n=j().setDialog,t=Object(a.useState)(!1),l=Object(m.a)(t,2),o=l[0],c=l[1],u=Object(a.useRef)(null),s=Object(p.useQuery)(Q,{notifyOnNetworkStatusChange:!0,onCompleted:function(){u.current&&u.current(),u.current=null},context:{loaderText:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0433\u0440\u0443\u043f\u043f..."}}),d=s.data,b=s.refetch,f=Object(a.useCallback)((function(e){}),[]),E=Object(a.useCallback)((function(e){u.current=e.detail.complete,N(),b()}),[b]),h=Object(p.useMutation)(z,{update:function(e){return e.reset()}}),v=Object(m.a)(h,1)[0],g=Object(a.useCallback)((function(e){n({type:"destruction",title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435",message:"\u041f\u043e\u043a\u0438\u043d\u0443\u0432 \u0433\u0440\u0443\u043f\u043f\u0443, \u0432\u044b \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0432 \u043d\u0435\u0451 \u0432\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0431\u0435\u0437 \u0435\u0451 \u043f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0438",confirmText:"\u041f\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443",confirmHandler:function(){v({variables:{groupId:e}})}})}),[v,n]);return r.a.createElement(i.u,null,r.a.createElement(i.i,null,r.a.createElement(i.H,null,r.a.createElement(i.F,null,"\u0413\u0440\u0443\u043f\u043f\u044b"))),r.a.createElement(i.h,{fullscreen:!0},r.a.createElement(i.x,{slot:"fixed",onIonRefresh:E},r.a.createElement(i.y,null)),r.a.createElement(i.i,{collapse:"condense"},r.a.createElement(i.H,null,r.a.createElement(i.F,{size:"large"},"\u0413\u0440\u0443\u043f\u043f\u044b"))),r.a.createElement(i.a,{isOpen:o,header:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443",onDidDismiss:function(){return c(!1)},buttons:[{text:"\u041f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u0441\u044f",icon:y.k,handler:function(){e.push(W)}},{text:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0432\u043e\u044e",icon:y.a,handler:function(){e.push(V)}},{text:"\u041e\u0442\u043c\u0435\u043d\u0430",role:"cancel"}]}),d?r.a.createElement(i.q,{lines:"full"},d.joinedGroups.map((function(e){var n=e.id,t=e.membersCount,a=e.name,l=e.ownerSmallAvatar;return r.a.createElement(i.o,{key:n},r.a.createElement(i.l,{button:!0,onClick:function(){return f(n)}},l&&r.a.createElement(i.d,{slot:"start"},r.a.createElement("img",{alt:"Group owner's avatar",src:l})),r.a.createElement(i.p,null,a),r.a.createElement(i.t,{slot:"end"},r.a.createElement(i.j,{icon:y.n})," ",t)),r.a.createElement(i.n,{side:"end"},r.a.createElement(i.m,{color:"danger",onClick:function(){return g(n)}},"\u041f\u043e\u043a\u0438\u043d\u0443\u0442\u044c")))})),d.joinedGroups.length<20&&r.a.createElement(i.l,{button:!0,onClick:function(){return c(!0)}},r.a.createElement(i.j,{slot:"start",icon:y.b,style:{color:"lime"}}),r.a.createElement(i.p,null,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"))):r.a.createElement(r.a.Fragment,null,r.a.createElement(i.f,{expand:"block",onClick:function(){return b()}},"\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c"))))};Object(i.Q)({backButtonText:"\u043d\u0430\u0437\u0430\u0434"});var J=function(){return C({darkSchemeBodyClass:"dark"}),r.a.createElement(i.c,null,r.a.createElement(u.a,null,r.a.createElement(i.u,null,r.a.createElement(v,null,r.a.createElement(i.A,null,r.a.createElement(c.b,{path:"/",exact:!0,render:function(){return r.a.createElement(c.a,{to:R})}}),r.a.createElement(c.b,{path:R,exact:!0,component:U}),r.a.createElement(c.b,{path:V,exact:!0,component:D}),r.a.createElement(c.b,{path:W,exact:!0,component:H}),r.a.createElement(c.b,{path:"/group/",component:O}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(135),t(136),t(137),t(138),t(139),t(140),t(141),t(142),t(143),t(144),t(145),t(146);o.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[117,3,4]]]);
//# sourceMappingURL=main.75c20bcc.chunk.js.map